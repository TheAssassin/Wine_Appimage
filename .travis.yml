sudo: required

language: cpp
services:
  - docker

before_install:
  - wget -nv -c https://dl.winehq.org/wine-builds/ubuntu/dists/bionic/main/binary-i386/wine-staging_4.3~bionic_i386.deb
  - wget -nv -c https://dl.winehq.org/wine-builds/ubuntu/dists/bionic/main/binary-i386/wine-staging-i386_4.3~bionic_i386.deb
  - wget -nv -c "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-x86_64.AppImage" -O  appimagetool.AppImage

script:
  - docker build . -f deploydocker/Dockerfile.winedeploy.ubuntu.latest -t wineappimage.ubuntu.latest
  # - docker build . -f deploydocker/Dockerfile.winedeploy.debian.buster -t wineappimage.debian.buster
  # - docker build . -f deploydocker/Dockerfile.winedeploy.debian.stretch -t wineappimage.debian.stretch
  # - docker build . -f deploydocker/Dockerfile.winedeploy.arch.latest -t wineappimage.arch.latest

after_success:
  - mkdir apps
  - docker run --rm -v $(pwd)/apps:/tmp/apps -ti wineappimage.ubuntu.latest cp Wine-x86_64.AppImage /tmp/apps/Wine-x86_64-ubuntu.latest.AppImage
  # - docker run --rm -v $(pwd)/apps:/tmp/apps -ti wineappimage.debian.buster cp Wine-x86_64.AppImage /tmp/apps/Wine-x86_64-debian.buster.AppImage
  # - docker run --rm -v $(pwd)/apps:/tmp/apps -ti wineappimage.debian.stretch cp Wine-x86_64.AppImage /tmp/apps/Wine-x86_64-debian.stretch.AppImage
  # - docker run --rm -v $(pwd)/apps:/tmp/apps -ti wineappimage.arch.latest cp Wine-x86_64.AppImage /tmp/apps/Wine-x86_64-arch.latest.AppImage
  # - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  # - bash upload.sh apps/*

deploy:
  provider: releases
  api_key:
    secure: M+XpPIrecHwDcLyflI1hw31LkPIpAr0D1klGFnI23PpyhP2AhubReeynN/HGq/IuikrrDXanszRA2jSIMn2EZA18QCiowViDoOs46ajdFtAWRGNpuWG+PGrumwXo70bv05n/ECwaS7m2vVUh/IqF4P5PlwDU8/ppjBBbQAdn5KHN0gUs/+ZTYA7FlIOxVEW1sssaFoECJR6WJqAQMIpGEBGD9gEedDyIBmb1Qin9/u6opEJfcGB9Ic9CQBloCCDGLQeYr1oELNrgmolFGDyFFPIYdRS8Wf7dkwp1TDfd6OpQ0uBptylEeHJW6Bwq+Npja/otVhnfwJIcbY6BQIRJ760M6tQ58sWCj8UGfLxgD2gGtqPeiOOsy/KEH4trTYPJcVRl88LjLFA1YY3N7DSGGeZAsMt1JlKy1y2rOPvHQn65mec9OQlT91AihZ7FOrzFl37BZI3rZ/3ekGPUu9WyDhO+0ct6z+9HBl5c0GCCwdX4Q93g+Puy5/mDzlu5EvCbKEDLcNwkACDAnjt2C3CXzI6g2RXnSoYlogupYB/97CUj0MVuR+MV4TfjY+EWkovRzUFhbWf5SRC4v4ZV7KX7A3d2sG7+EaczrxTF3FHO9+yjw/Ys6gtqdSLJ4btXAAP5KfCDygCDHHiXlRM1/EZDL0X5SHBs6W5XLNTDkS10NiM=
  file: /tmp/apps/Wine-x86_64-ubuntu.latest.AppImage
  skip_cleanup: true
  prerelease: true
  on:
    repo: mmtrt/Wine_Appimage
    branch: test